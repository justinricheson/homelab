# Base Node Setup for Raspberry Pi 5

- OS
  - [Flash sdcard](https://www.raspberrypi.com/software)
    - Hostname: pi<num>
    - Username / password
    - Enable ssh
  - Boot and clone sdcard to nvme
    - [rpi-clone](https://github.com/geerlingguy/rpi-clone)
    - Install:
      - `git clone https://github.com/geerlingguy/rpi-clone.git`
      - `cd rpi-clone && sudo cp rpi-clone rpi-clone-setup /usr/local/sbin`
    - Clone: `sudo rpi-clone /dev/nvme0n1`
      - Leave the optional filesystem label empty
    - `sudo shutdown -h now`
    - Remove sdcard, and reboot
    - Cleanup rpi-clone:
      - `sudo rm /usr/local/sbin/rpi-clone`
      - `sudo rm /usr/local/sbin/rpi-clone-setup`

- Packages
  - Yum update
    - `sudo apt update`
    - `sudo apt full-upgrade -y`
    - `sudo apt autoremove -y`
    - `sudo reboot`
  - Setup iscsi (for longhorn)
    - `sudo apt install -y open-iscsi`
    - `sudo reboot`
    - `sudo systemctl enable iscsid`
    - `sudo systemctl start iscsid`

- Config
  - Set static dns
    - Without this, the node canâ€™t resolve containers before dns is setup.
      - Since dns runs on k0s, a reboot creates a cycle, dns -> k0s -> dns.
    - `nmcli device status`
    - `nmcli connection show`
    - `sudo nmcli connection modify "Wired connection 1" ipv4.dns 1.1.1.1`
    - `sudo nmcli connection modify "Wired connection 1" ipv4.ignore-auto-dns yes`
    - `sudo reboot`
  - Update raspi-config
    - `sudo raspi-config`
    - `update`
    - `sudo reboot`
  - Set wifi country
    - `sudo raspi-config`
    - `Localization Options > WLAN Country`
    - `sudo reboot`

- K0s
  - Enable cgroups
    - `sudo nano /boot/firmware/cmdline.txt`
    - Add this to the end of the line: ` cgroup_memory=1 cgroup_enable=memory`
  - Refer to generic K0s doc for remaining instructions